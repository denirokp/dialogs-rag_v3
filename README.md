# ๐ Dialogs RAG Pipeline System

ะกะธััะตะผะฐ ะฐะฝะฐะปะธะทะฐ ะดะธะฐะปะพะณะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะผะฝะพะณะพััะฐะฟะฝะพะณะพ pipeline ะธ RAG (Retrieval-Augmented Generation) ัะตัะฝะพะปะพะณะธะธ.

## ๐๏ธ ะััะธัะตะบัััะฐ

ะกะธััะตะผะฐ ะฟะพัััะพะตะฝะฐ ะฒะพะบััะณ **Pipeline Manager** ะบะฐะบ ัะตะฝััะฐะปัะฝะพะณะพ ะบะพะผะฟะพะฝะตะฝัะฐ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Pipeline Manager                         โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โ  โ   Stage 1   โ  โ   Stage 2   โ  โ   Stage 3   โ  ...   โ
โ  โ ะะตัะตะบัะธั    โ  โ ะะทะฒะปะตัะตะฝะธะต  โ  โะะพัะผะฐะปะธะทะฐัะธั โ        โ
โ  โ ะดะพััะฐะฒะบะธ    โ  โ ัััะฝะพััะตะน   โ  โัะพัะผัะปะธัะพะฒะพะบ โ        โ
โ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโ        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ                    โ                    โ
    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
    โ Pipeline    โ    โ Pipeline    โ    โ Pipeline    โ
    โ Core        โ    โ API         โ    โ Dashboard   โ
    โ (ะะธะทะฝะตั-    โ    โ (REST API)  โ    โ (Web UI)    โ
    โ  ะปะพะณะธะบะฐ)    โ    โ             โ    โ             โ
    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
```

## โจ ะะปััะตะฒัะต ะฒะพะทะผะพะถะฝะพััะธ

- **ะะฒัะพะผะฐัะธัะตัะบะพะต ะธะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน** ะธะท ะดะธะฐะปะพะณะพะฒ (ะฑะฐััะตัั, ะธะดะตะธ, ัะธะณะฝะฐะปั)
- **ะฃะผะฝะฐั ะบะปะฐััะตัะธะทะฐัะธั** ะฟะพัะพะถะธั ัะพัะผัะปะธัะพะฒะพะบ
- **ะัะธััะบะฐ ะธ ะฝะพัะผะฐะปะธะทะฐัะธั** ัะตะบััะฐ
- **ะะตะฝะตัะฐัะธั ะพััะตัะพะฒ** ะฒ Markdown ะธ Excel
- **REST API** ะดะปั ะธะฝัะตะณัะฐัะธะธ
- **ะะตะฑ-ะดะฐัะฑะพัะด** ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ

## ๐ ะัััััะน ััะฐัั

### 1. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
```bash
pip install -r requirements.txt
```

### 2. ะะฐัััะพะนะบะฐ API ะบะปััะฐ
```bash
export OPENAI_API_KEY="your-api-key"
```

### 3. ะะฐะฟััะบ pipeline
```bash
python pipeline_manager.py --stages all
```

### 4. ะะฐะฟััะบ ะฟะพะปะฝะพะน ัะธััะตะผั (API + Dashboard)
```bash
# API ัะตัะฒะตั
python api/pipeline_api.py

# ะะฐัะฑะพัะด (ะฒ ะดััะณะพะผ ัะตัะผะธะฝะฐะปะต)
python dashboard/pipeline_dashboard.py
```

## ๐ ะญัะฐะฟั Pipeline

| ะญัะฐะฟ | ะะฐะทะฒะฐะฝะธะต | ะะฟะธัะฐะฝะธะต | ะัะพะดะฝัะต ะดะฐะฝะฝัะต | ะััะพะดะฝัะต ะดะฐะฝะฝัะต |
|------|----------|----------|----------------|-----------------|
| 1 | ะะตัะตะบัะธั ะดะพััะฐะฒะบะธ | ะะฟัะตะดะตะปะตะฝะธะต ะดะธะฐะปะพะณะพะฒ ั ะพะฑััะถะดะตะฝะธะตะผ ะดะพััะฐะฒะบะธ | Excel ัะฐะนะป ั ะดะธะฐะปะพะณะฐะผะธ | `stage1_delivery.jsonl` |
| 2 | ะะทะฒะปะตัะตะฝะธะต ัััะฝะพััะตะน | ะะทะฒะปะตัะตะฝะธะต ะฑะฐััะตัะพะฒ, ะธะดะตะน, ัะธะณะฝะฐะปะพะฒ | ะะตะทัะปััะฐัั ััะฐะฟะฐ 1 | `stage2_extracted.jsonl` |
| 3 | ะะพัะผะฐะปะธะทะฐัะธั ัะพัะผัะปะธัะพะฒะพะบ | ะัะธะฒะตะดะตะฝะธะต ะบ ะตะดะธะฝะพะผั ะฒะธะดั | ะะตะทัะปััะฐัั ััะฐะฟะฐ 2 | `stage3_normalized.jsonl` |
| 4 | ะะปะฐััะตัะธะทะฐัะธั | ะััะฟะฟะธัะพะฒะบะฐ ะฟะพัะพะถะธั ัะพัะผัะปะธัะพะฒะพะบ | ะะตะทัะปััะฐัั ััะฐะฟะฐ 3 | `stage4_clusters.json` |
| 5 | ะะณัะตะณะฐัะธั ะผะตััะธะบ | ะะฐััะตั ััะฐัะธััะธะบะธ ะธ ะผะตััะธะบ | ะะตะทัะปััะฐัั ััะฐะฟะฐ 4 | `aggregate_results.json` |
| 6 | ะะตะฝะตัะฐัะธั ะพััะตัะพะฒ | ะกะพะทะดะฐะฝะธะต ัะธะฝะฐะปัะฝัั ะพััะตัะพะฒ | ะะตะทัะปััะฐัั ััะฐะฟะฐ 5 | `report.md`, `report.xlsx` |

## ๐๏ธ ะะพะผะฟะพะฝะตะฝัั ัะธััะตะผั

### Pipeline Manager (`pipeline_manager.py`)
ะฆะตะฝััะฐะปัะฝัะน ะผะตะฝะตะดะถะตั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฒัะตะผะธ ััะฐะฟะฐะผะธ:
- ะะฐะฟััะบ ะพัะดะตะปัะฝัั ััะฐะฟะพะฒ ะธะปะธ ะฒัะตะณะพ pipeline
- ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐะฒะธัะธะผะพัััะผะธ ะผะตะถะดั ััะฐะฟะฐะผะธ
- ะััะปะตะถะธะฒะฐะฝะธะต ััะฐัััะฐ ะฒัะฟะพะปะฝะตะฝะธั
- ะกะพััะฐะฝะตะฝะธะต ัะพััะพัะฝะธั pipeline

### Pipeline Core (`core/pipeline_core.py`)
ะะธะทะฝะตั-ะปะพะณะธะบะฐ ัะธััะตะผั:
- ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐะฟัะพัะฐะผะธ ะฝะฐ ะฐะฝะฐะปะธะท
- ะัะธะฝััะพะฝะฝะพะต ะฒัะฟะพะปะฝะตะฝะธะต pipeline
- ะะฐะฑะพัะฐ ั ัะตะทัะปััะฐัะฐะผะธ ะฐะฝะฐะปะธะทะฐ
- ะกะตัะฒะธั ะดะฐะฝะฝัั

### Pipeline API (`api/pipeline_api.py`)
REST API ะดะปั ัะฟัะฐะฒะปะตะฝะธั ัะธััะตะผะพะน:
- ะะฐะฟััะบ pipeline ัะตัะตะท HTTP
- ะะพะปััะตะฝะธะต ััะฐัััะฐ ะธ ัะตะทัะปััะฐัะพะฒ
- ะฃะฟัะฐะฒะปะตะฝะธะต ัะฐะนะปะฐะผะธ
- ะกะธััะตะผะฝะฐั ะธะฝัะพัะผะฐัะธั

### Pipeline Dashboard (`dashboard/pipeline_dashboard.py`)
ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั:
- ะะธะทัะฐะปะธะทะฐัะธั ัะตะทัะปััะฐัะพะฒ
- ะฃะฟัะฐะฒะปะตะฝะธะต pipeline
- ะะพะฝะธัะพัะธะฝะณ ัะธััะตะผั
- ะกะบะฐัะธะฒะฐะฝะธะต ะพััะตัะพะฒ

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### CLI ะธะฝัะตััะตะนั

```bash
# ะะฐะฟััะบ ะฒัะตั ััะฐะฟะพะฒ
python pipeline_manager.py --stages all

# ะะฐะฟััะบ ะบะพะฝะบัะตัะฝัั ััะฐะฟะพะฒ
python pipeline_manager.py --stages 1 2 3

# ะะฐะฟััะบ ั ะพะฟัะตะดะตะปะตะฝะฝะพะณะพ ััะฐะฟะฐ
python pipeline_manager.py --from 3

# ะะฐะฟััะบ ะดะพ ะพะฟัะตะดะตะปะตะฝะฝะพะณะพ ััะฐะฟะฐ
python pipeline_manager.py --to 4

# ะะฐะฟััะบ ั ะบะฐััะพะผะฝะพะน ะบะพะฝัะธะณััะฐัะธะตะน
python pipeline_manager.py --stages all --skip-failed
```

### API ะธะฝัะตััะตะนั

```bash
# ะะฐะฟััะบ pipeline
curl -X POST "http://localhost:8000/pipeline/run" \
     -H "Content-Type: application/json" \
     -d '{"input_file": "data/dialogs.xlsx", "stages": ["1", "2", "3", "4", "5", "6"]}'

# ะะพะปััะตะฝะธะต ััะฐัััะฐ
curl "http://localhost:8000/pipeline/status/{request_id}"

# ะะพะปััะตะฝะธะต ัะตะทัะปััะฐัะพะฒ
curl "http://localhost:8000/pipeline/results/{request_id}"

# ะกะฟะธัะพะบ ะฐะฝะฐะปะธะทะพะฒ
curl "http://localhost:8000/pipeline/analyses"
```

### ะะตะฑ-ะธะฝัะตััะตะนั

ะัะบัะพะนัะต http://localhost:8501 ะฒ ะฑัะฐัะทะตัะต ะดะปั ะดะพัััะฟะฐ ะบ ะดะฐัะฑะพัะดั.

## ๐ง ะะพะฝัะธะณััะฐัะธั

### PipelineConfig
```python
@dataclass
class PipelineConfig:
    input_file: str = "data/dialogs.xlsx"
    output_dir: str = "artifacts"
    reports_dir: str = "reports"
    logs_dir: str = "logs"
    batch_size: int = 100
    max_retries: int = 3
    parallel_execution: bool = False
    skip_failed_stages: bool = False
    cleanup_intermediate: bool = False
```

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั
```bash
export OPENAI_API_KEY="your-api-key"
export CHROMA_PATH="./chroma_db"
export LOG_LEVEL="INFO"
```

## ๐ ะะตะทัะปััะฐัั

ะะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั pipeline ัะตะทัะปััะฐัั ัะพััะฐะฝััััั ะฒ:

### ะััะตัะฐะบัั (`artifacts/`)
- `stage1_delivery.jsonl` - ัะตะทัะปััะฐัั ะดะตัะตะบัะธะธ ะดะพััะฐะฒะบะธ
- `stage2_extracted.jsonl` - ะธะทะฒะปะตัะตะฝะฝัะต ัััะฝะพััะธ
- `stage3_normalized.jsonl` - ะฝะพัะผะฐะปะธะทะพะฒะฐะฝะฝัะต ัะพัะผัะปะธัะพะฒะบะธ
- `stage4_clusters.json` - ะบะปะฐััะตัั ัะพัะผัะปะธัะพะฒะพะบ
- `aggregate_results.json` - ะฐะณัะตะณะธัะพะฒะฐะฝะฝัะต ะผะตััะธะบะธ
- `barriers.csv`, `ideas.csv`, `signals.csv` - CSV ะพััะตัั

### ะััะตัั (`reports/`)
- `report.md` - ะดะตัะฐะปัะฝัะน Markdown ะพััะตั
- `report.xlsx` - Excel ะพััะตั ะดะปั ะฐะฝะฐะปะธะทะฐ
- `appendix_ids.md` - ะฟัะธะปะพะถะตะฝะธะต ั ID ะดะธะฐะปะพะณะพะฒ

## ๐ ะะพะฝะธัะพัะธะฝะณ

### ะะพะณะธ
- `logs/pipeline_manager.log` - ะปะพะณะธ pipeline
- `logs/pipeline_api.log` - ะปะพะณะธ API
- `logs/pipeline_dashboard.log` - ะปะพะณะธ ะดะฐัะฑะพัะดะฐ

### ะะตััะธะบะธ
- ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะบะฐะถะดะพะณะพ ััะฐะฟะฐ
- ะะพะปะธัะตััะฒะพ ะพะฑัะฐะฑะพัะฐะฝะฝัั ะดะธะฐะปะพะณะพะฒ
- ะกัะฐัะธััะธะบะฐ ะพัะธะฑะพะบ
- ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะตััััะพะฒ

## ๐จ ะขัะตะฑะพะฒะฐะฝะธั

- Python 3.8+
- OpenAI API ะบะปัั
- ChromaDB
- ะัะต ะทะฐะฒะธัะธะผะพััะธ ะธะท `requirements.txt`

## ๐๏ธ ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ
```
dialogs-rag/
โโโ pipeline_manager.py          # ะฆะตะฝััะฐะปัะฝัะน ะผะตะฝะตะดะถะตั
โโโ core/
โ   โโโ pipeline_core.py         # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โโโ api/
โ   โโโ pipeline_api.py          # REST API
โโโ dashboard/
โ   โโโ pipeline_dashboard.py    # ะะตะฑ-ะธะฝัะตััะตะนั
โโโ pipeline/                    # ะญัะฐะฟั pipeline
โ   โโโ stage1_detect_delivery.py
โ   โโโ stage2_extract_entities.py
โ   โโโ stage3_normalize.py
โ   โโโ stage4_cluster.py
โ   โโโ stage5_aggregate.py
โ   โโโ stage6_report.py
โโโ pipeline_manager.py          # ะะปะฐะฒะฝัะน ัะบัะธะฟั
โโโ requirements.txt
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ััะฐะฟะฐ
1. ะกะพะทะดะฐะนัะต ัะฐะนะป `pipeline/stageN_new_stage.py`
2. ะะพะฑะฐะฒััะต ััะฝะบัะธั `main()` ะฒ ัะฐะนะป
3. ะะฑะฝะพะฒะธัะต `pipeline_manager.py` - ะดะพะฑะฐะฒััะต ััะฐะฟ ะฒ `_initialize_stages()`
4. ะะฑะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ ะฒ ะดััะณะธั ััะฐะฟะฐั ะฟัะธ ะฝะตะพะฑัะพะดะธะผะพััะธ

### ะขะตััะธัะพะฒะฐะฝะธะต
```bash
# ะะฐะฟััะบ ัะตััะพะฒ
python -m pytest tests/

# ะะฐะฟััะบ ะบะพะฝะบัะตัะฝะพะณะพ ััะฐะฟะฐ
python pipeline/stage1_detect_delivery.py

# ะัะพะฒะตัะบะฐ API
curl http://localhost:8000/health
```

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ:
1. ะัะพะฒะตัััะต ะปะพะณะธ ะฒ ะฟะฐะฟะบะต `logs/`
2. ะฃะฑะตะดะธัะตัั, ััะพ ะฒัะต ะทะฐะฒะธัะธะผะพััะธ ัััะฐะฝะพะฒะปะตะฝั
3. ะัะพะฒะตัััะต ะบะพะฝัะธะณััะฐัะธั ะฒ `PipelineConfig`
4. ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั OpenAI API

---

**ะกะธััะตะผะฐ ะณะพัะพะฒะฐ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั! ๐**
